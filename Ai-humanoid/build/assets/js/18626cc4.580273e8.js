"use strict";(globalThis.webpackChunkphysical_ai_humanoid_robotics_textbook=globalThis.webpackChunkphysical_ai_humanoid_robotics_textbook||[]).push([[1984],{6196:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"Module1-ROS/Chapter2-Nodes,TopicsService,Action/1-2-3-Services","title":"2.3 - Services","description":"---","source":"@site/docs/Module1-ROS/Chapter2-Nodes,TopicsService,Action/1-2.3 Services.md","sourceDirName":"Module1-ROS/Chapter2-Nodes,TopicsService,Action","slug":"/Module1-ROS/Chapter2-Nodes,TopicsService,Action/1-2-3-Services","permalink":"/docs/Module1-ROS/Chapter2-Nodes,TopicsService,Action/1-2-3-Services","draft":false,"unlisted":false,"editUrl":"https://github.com/areebayaseen15/Ai-Humanoid-textbook/edit/main/docs/Module1-ROS/Chapter2-Nodes,TopicsService,Action/1-2.3 Services.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"1-2-3-Services","sidebar_position":3,"title":"2.3 - Services"},"sidebar":"tutorialSidebar","previous":{"title":"2.2 - Topics","permalink":"/docs/Module1-ROS/Chapter2-Nodes,TopicsService,Action/1-2-2-Topics"},"next":{"title":"2.4 - Actions","permalink":"/docs/Module1-ROS/Chapter2-Nodes,TopicsService,Action/1-2-4-Actions"}}');var i=n(4848),t=n(8453);const o={id:"1-2-3-Services",sidebar_position:3,title:"2.3 - Services"},c=void 0,l={},a=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Key Concepts",id:"key-concepts",level:2},{value:"Basic Service Server Implementation",id:"basic-service-server-implementation",level:2},{value:"Basic Service Client Implementation",id:"basic-service-client-implementation",level:2},{value:"Custom Service Implementation",id:"custom-service-implementation",level:2}];function d(e){const r={code:"code",h1:"h1",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.h1,{id:"23-services-synchronous-requestresponse",children:"2.3 Services: Synchronous Request/Response"}),"\n",(0,i.jsx)(r.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Understand the synchronous request/response communication model."}),"\n",(0,i.jsxs)(r.li,{children:["Implement ROS 2 service servers and clients in Python using ",(0,i.jsx)(r.code,{children:"rclpy"}),"."]}),"\n",(0,i.jsx)(r.li,{children:"Learn to define and use custom ROS IDL service types."}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"key-concepts",children:"Key Concepts"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"ROS 2 Services"}),": Synchronous request/response communication pattern"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Service Server"}),": Node that provides a service"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Service Client"}),": Node that requests a service"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Request/Response Pattern"}),": Synchronous communication model"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Service Types"}),": Standardized request/response message structures"]}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:["This section details synchronous services. It covers the server and client roles, how to implement them in ",(0,i.jsx)(r.code,{children:"rclpy"}),", and how to define custom ",(0,i.jsx)(r.code,{children:".srv"})," files using ROS IDL. The explanation contrasts services with topics, highlighting their use cases for one-shot requests with immediate responses. Examples include both standard and custom service types."]}),"\n",(0,i.jsx)(r.h2,{id:"basic-service-server-implementation",children:"Basic Service Server Implementation"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts # Standard service type\r\n\r\nclass MinimalService(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_service')\r\n        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)\r\n        self.get_logger().info('Add Two Ints Service Ready.')\r\n\r\n    def add_two_ints_callback(self, request, response):\r\n        response.sum = request.a + request.b\r\n        self.get_logger().info(f'Incoming request: a={request.a}, b={request.b}, sum={response.sum}')\r\n        return response\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    minimal_service = MinimalService()\r\n    rclpy.spin(minimal_service)\r\n    minimal_service.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"basic-service-client-implementation",children:"Basic Service Client Implementation"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\nfrom example_interfaces.srv import AddTwoInts\r\nimport sys\r\n\r\nclass MinimalClientAsync(Node):\r\n    def __init__(self):\r\n        super().__init__('minimal_client_async')\r\n        self.cli = self.create_client(AddTwoInts, 'add_two_ints')\r\n        while not self.cli.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('service not available, waiting again...')\r\n        self.req = AddTwoInts.Request()\r\n\r\n    def send_request(self, a, b):\r\n        self.req.a = a\r\n        self.req.b = b\r\n        self.future = self.cli.call_async(self.req)\r\n        self.get_logger().info(f'Requesting: {a} + {b}')\r\n        rclpy.spin_until_future_complete(self, self.future)\r\n        return self.future.result()\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n\r\n    if len(sys.argv) != 3:\r\n        print('Usage: ros2 run <package_name> minimal_client_async <arg1> <arg2>')\r\n        return\r\n\r\n    minimal_client = MinimalClientAsync()\r\n    response = minimal_client.send_request(int(sys.argv[1]), int(sys.argv[2]))\r\n    minimal_client.get_logger().info(f'Result of add_two_ints: {response.sum}')\r\n\r\n    minimal_client.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"custom-service-implementation",children:"Custom Service Implementation"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"# In my_robot_controller/srv/SetSpeed.srv\r\n# float32 speed\r\n# ---\r\n# bool success\r\n\r\n# Python service server using custom service\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom my_robot_controller.srv import SetSpeed # Import custom service\r\n\r\nclass CustomServiceServer(Node):\r\n    def __init__(self):\r\n        super().__init__('custom_service_server')\r\n        self.srv = self.create_service(SetSpeed, 'set_robot_speed', self.set_speed_callback)\r\n        self.current_speed = 0.0\r\n        self.get_logger().info('Set Speed Service Ready.')\r\n\r\n    def set_speed_callback(self, request, response):\r\n        self.current_speed = request.speed\r\n        response.success = True\r\n        self.get_logger().info(f'Received speed request: {request.speed}. Current speed set to {self.current_speed}')\r\n        return response\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    server_node = CustomServiceServer()\r\n    rclpy.spin(server_node)\r\n    server_node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n\r\n# Python service client using custom service\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom my_robot_controller.srv import SetSpeed\r\nimport sys\r\n\r\nclass CustomServiceClient(Node):\r\n    def __init__(self):\r\n        super().__init__('custom_service_client')\r\n        self.cli = self.create_client(SetSpeed, 'set_robot_speed')\r\n        while not self.cli.wait_for_service(timeout_sec=1.0):\r\n            self.get_logger().info('custom service not available, waiting again...')\r\n        self.req = SetSpeed.Request()\r\n\r\n    def send_request(self, speed_value):\r\n        self.req.speed = float(speed_value)\r\n        self.future = self.cli.call_async(self.req)\r\n        self.get_logger().info(f'Requesting speed change to: {self.req.speed}')\r\n        rclpy.spin_until_future_complete(self, self.future)\r\n        return self.future.result()\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n\r\n    if len(sys.argv) != 2:\r\n        print('Usage: ros2 run <package_name> custom_service_client <speed_value>')\r\n        return\r\n\r\n    client_node = CustomServiceClient()\r\n    response = client_node.send_request(sys.argv[1])\r\n    if response.success:\r\n        client_node.get_logger().info(f'Service call successful: speed set.')\r\n    else:\r\n        client_node.get_logger().warn(f'Service call failed.')\r\n\r\n    client_node.destroy_node()\r\n    rclpy.shutdown()\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})})]})}function p(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>c});var s=n(6540);const i={},t=s.createContext(i);function o(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(t.Provider,{value:r},e.children)}}}]);