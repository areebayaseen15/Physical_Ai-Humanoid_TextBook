---
id: 1-2-3-Services
sidebar_position: 3
title: 2.3 - Services
---
---

# 2.3 Services: Synchronous Request/Response

## Learning Objectives
- Understand the synchronous request/response communication model.
- Implement ROS 2 service servers and clients in Python using `rclpy`.
- Learn to define and use custom ROS IDL service types.

## Key Concepts
- **ROS 2 Services**: Synchronous request/response communication pattern
- **Service Server**: Node that provides a service
- **Service Client**: Node that requests a service
- **Request/Response Pattern**: Synchronous communication model
- **Service Types**: Standardized request/response message structures

This section details synchronous services. It covers the server and client roles, how to implement them in `rclpy`, and how to define custom `.srv` files using ROS IDL. The explanation contrasts services with topics, highlighting their use cases for one-shot requests with immediate responses. Examples include both standard and custom service types.

<!-- DIAGRAM: Detailed Service client-server interaction flow -->

## Basic Service Server Implementation

```python
import rclpy
from rclpy.node import Node
from example_interfaces.srv import AddTwoInts # Standard service type

class MinimalService(Node):
    def __init__(self):
        super().__init__('minimal_service')
        self.srv = self.create_service(AddTwoInts, 'add_two_ints', self.add_two_ints_callback)
        self.get_logger().info('Add Two Ints Service Ready.')

    def add_two_ints_callback(self, request, response):
        response.sum = request.a + request.b
        self.get_logger().info(f'Incoming request: a={request.a}, b={request.b}, sum={response.sum}')
        return response

def main(args=None):
    rclpy.init(args=args)
    minimal_service = MinimalService()
    rclpy.spin(minimal_service)
    minimal_service.destroy_node()
    rclpy.shutdown()

if __name__ == '__main__':
    main()
```

## Basic Service Client Implementation

```python
import rclpy
from rclpy.node import Node
from example_interfaces.srv import AddTwoInts
import sys

class MinimalClientAsync(Node):
    def __init__(self):
        super().__init__('minimal_client_async')
        self.cli = self.create_client(AddTwoInts, 'add_two_ints')
        while not self.cli.wait_for_service(timeout_sec=1.0):
            self.get_logger().info('service not available, waiting again...')
        self.req = AddTwoInts.Request()

    def send_request(self, a, b):
        self.req.a = a
        self.req.b = b
        self.future = self.cli.call_async(self.req)
        self.get_logger().info(f'Requesting: {a} + {b}')
        rclpy.spin_until_future_complete(self, self.future)
        return self.future.result()

def main(args=None):
    rclpy.init(args=args)

    if len(sys.argv) != 3:
        print('Usage: ros2 run <package_name> minimal_client_async <arg1> <arg2>')
        return

    minimal_client = MinimalClientAsync()
    response = minimal_client.send_request(int(sys.argv[1]), int(sys.argv[2]))
    minimal_client.get_logger().info(f'Result of add_two_ints: {response.sum}')

    minimal_client.destroy_node()
    rclpy.shutdown()

if __name__ == '__main__':
    main()
```

## Custom Service Implementation

```python
# In my_robot_controller/srv/SetSpeed.srv
# float32 speed
# ---
# bool success

# Python service server using custom service
import rclpy
from rclpy.node import Node
from my_robot_controller.srv import SetSpeed # Import custom service

class CustomServiceServer(Node):
    def __init__(self):
        super().__init__('custom_service_server')
        self.srv = self.create_service(SetSpeed, 'set_robot_speed', self.set_speed_callback)
        self.current_speed = 0.0
        self.get_logger().info('Set Speed Service Ready.')

    def set_speed_callback(self, request, response):
        self.current_speed = request.speed
        response.success = True
        self.get_logger().info(f'Received speed request: {request.speed}. Current speed set to {self.current_speed}')
        return response

def main(args=None):
    rclpy.init(args=args)
    server_node = CustomServiceServer()
    rclpy.spin(server_node)
    server_node.destroy_node()
    rclpy.shutdown()

if __name__ == '__main__':
    main()

# Python service client using custom service
import rclpy
from rclpy.node import Node
from my_robot_controller.srv import SetSpeed
import sys

class CustomServiceClient(Node):
    def __init__(self):
        super().__init__('custom_service_client')
        self.cli = self.create_client(SetSpeed, 'set_robot_speed')
        while not self.cli.wait_for_service(timeout_sec=1.0):
            self.get_logger().info('custom service not available, waiting again...')
        self.req = SetSpeed.Request()

    def send_request(self, speed_value):
        self.req.speed = float(speed_value)
        self.future = self.cli.call_async(self.req)
        self.get_logger().info(f'Requesting speed change to: {self.req.speed}')
        rclpy.spin_until_future_complete(self, self.future)
        return self.future.result()

def main(args=None):
    rclpy.init(args=args)

    if len(sys.argv) != 2:
        print('Usage: ros2 run <package_name> custom_service_client <speed_value>')
        return

    client_node = CustomServiceClient()
    response = client_node.send_request(sys.argv[1])
    if response.success:
        client_node.get_logger().info(f'Service call successful: speed set.')
    else:
        client_node.get_logger().warn(f'Service call failed.')

    client_node.destroy_node()
    rclpy.shutdown()

if __name__ == '__main__':
    main()
```